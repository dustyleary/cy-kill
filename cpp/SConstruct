def BaseEnv():
    env = Environment(
        MSVC_VERSION='9.0',
    )
    env.Append(
        LIBS=['winmm'],
        LINKFLAGS=['/DEBUG'],
        CCFLAGS=['/EHsc', '/Zi', '-DHAVE_SSE2=1', '-DMEXP=19937'],
        CPPPATH=[
            '#/../ext',
            '#/../ext/googletest',
            '#/../ext/googletest/include',
            '#/../ext/mt'
        ],
    )
    return env

def Release(env):
    env['DEBUG'] = False
    env.Append(
        CCFLAGS=[
            '/MT', '/Ox', '/O2', '/Oi', '/Ot', '/Oy',
            '/fp:fast', '/Gr', '/GL',
            #'/Og', '/arch:SSE2', 
        ],
        CPPDEFINES=['NDEBUG'],
        LINKFLAGS=['/OPT:REF', '/OPT:ICF', '/LTCG'],
    )

def Debug(env):
    env['DEBUG'] = True
    env.Append(
        CCFLAGS=['/Od'],
        CPPDEFINES=['DEBUG'],
    )

env = BaseEnv()

if 1:
    Debug(env)
else:
    Release(env)

test_files = [
    '#/../ext/googletest/src/gtest-all.cc',
    '#/../ext/googletest/src/gtest_main.cc',

    'test_natset.cpp',
    'test_board.cpp',
    'test_gtp.cpp',
    'gtp.cpp',
]

env.Program(target='test', source=test_files)
env.Program(target='playout', source=['playout.cpp', '#/../ext/mt/SFMT.c'])
env.Program(target='cy-kill', source=['cy-kill.cpp', 'gtp.cpp', '#/../ext/mt/SFMT.c'])

