def BaseEnv():
    env = Environment(
        MSVC_VERSION='9.0',
    )
    env.Append(
        LIBS=['winmm'],
        LINKFLAGS=['/DEBUG'],
        CCFLAGS=['/EHsc', '/Zi', '-DHAVE_SSE2=1', '-DMEXP=19937'],
        CPPPATH=[
            '#/../ext',
            '#/../ext/googletest',
            '#/../ext/googletest/include',
            '#/../ext/mt'
        ],
    )
    return env

def Release(env):
    env['DEBUG'] = False
    env.Append(
        CCFLAGS=[
            '/MT', '/Ox', '/O2', '/Oi', '/Ot', '/Oy',
            '/fp:fast', '/Gr', '/GL',
            #'/Og', '/arch:SSE2', 
        ],
        CPPDEFINES=['NDEBUG'],
        LINKFLAGS=['/OPT:REF', '/OPT:ICF', '/LTCG'],
    )

def Debug(env):
    env['DEBUG'] = True
    env.Append(
        CCFLAGS=['/Od'],
    )

env = BaseEnv()

if 0:
    Debug(env)
else:
    Release(env)

google_test_files = [
    '#/../ext/googletest/src/gtest-all.cc',
    '#/../ext/googletest/src/gtest_main.cc',
]
env.Program(target='test_intset', source=google_test_files + ['test_intset.cpp'])
env.Program(target='test_board', source=google_test_files + ['test_board.cpp'])
env.Program(target='playout', source=['playout.cpp', '#/../ext/mt/SFMT.c'])

