<!DOCTYPE HTML>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://github.com/jquery/qunit/raw/master/qunit/qunit.css" type="text/css" media="screen" />
    <script type="text/javascript" src="http://github.com/jquery/qunit/raw/master/qunit/qunit.js"></script>
    <script type="text/javascript" src="gorules.js"></script>

<script>
$(document).ready(function(){

module("countLiberties");

test("a", function() {
    var b = new Board(2);
    equals(0, b.countLiberties(0,0));
});

test("b", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    equals(2, b.countLiberties(0,0));
});

test("c", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    equals(2, b.countLiberties(0,0));
    equals(2, b.countLiberties(0,1));
});

test("d", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,0);
    equals(1, b.countLiberties(0,0));
    equals(1, b.countLiberties(0,1));
    equals(1, b.countLiberties(1,0));
});

test("e", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 1,1);
    equals(0, b.countLiberties(0,0));
    equals(0, b.countLiberties(0,1));
    equals(0, b.countLiberties(1,0));
    equals(0, b.countLiberties(1,1));
});

/*
test("speed", function() {
    //make a big spiral
    var b = new Board(19);
    for(var x=0; x<b.size/2; x+=2) {
        for(var y=x; y<b.size-x; y++) {
            b.makeMove(b.BLACK, x,y);
            b.makeMove(b.BLACK, y,b.size-x-1);
            b.makeMove(b.BLACK, b.size-x-1,y);
            b.makeMove(b.BLACK, y,x);
        }
        b.makeMove(b.EMPTY, x,x+1);
        b.makeMove(b.BLACK, x+1,x+2);
    }
    //time counting liberties
    var t1 = new Date().getTime();
    for(var i=0; i<500; i++) {
        b.countLiberties(0,0);
    }
    var t2 = new Date().getTime();
    console.log('speed took millis',t2-t1);
});
*/

module("makeMove");

test("simple", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    expect = ''
        +'#.'
        +'..'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 1,0);
    expect = ''
        +'##'
        +'..'
        ;
    equals(b.text, expect);
});

test("capture1", function() {
    var b = new Board(2);
    b.makeMove(b.WHITE, 0,0);
    b.makeMove(b.BLACK, 1,0);
    expect = ''
        +'O#'
        +'..'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 0,1);
    expect = ''
        +'.#'
        +'#.'
        ;
    equals(b.text, expect);
});

test("capture_ko", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 3,0);
    b.makeMove(b.WHITE, 2,1);
    expect = ''
        +'#.#O'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#OkO'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    //new move erases old ko
    b.makeMove(b.BLACK, 0,1);
    expect = ''
        +'#O.O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
});

test("capture_doesnt_think_simple_nonko_is_ko", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 0,0);
    b.makeMove(b.WHITE, 1,0);
    b.makeMove(b.WHITE, 2,1);
    b.makeMove(b.WHITE, 3,0);
    expect = ''
        +'OO.O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 2,0);
    expect = ''
        +'..#O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
});

test("capture_returns_new_prisoner_count", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.WHITE, 1,0);
    //not a capturing move
    var captures = b.makeMove(b.WHITE, 1,1);
    equals(0, captures[0]);
    equals(0, captures[1]);
    expect = ''
        +'#O.'
        +'#O.'
        +'#..'
        ;
    equals(b.text, expect);
    //capture
    var captures = b.makeMove(b.WHITE, 1,2);
    equals(3, captures[0]);
    equals(0, captures[1]);
});

test("ko_capture_returns_new_prisoner_count", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 3,0);
    b.makeMove(b.WHITE, 2,1);
    var captures = b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#OkO'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    equals(1, captures[0]);
    equals(0, captures[1]);

    b.makeMove(b.BLACK, 0,1);
    var captures = b.makeMove(b.BLACK, 2,0);
    expect = ''
        +'#k#O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    equals(0, captures[0]);
    equals(1, captures[1]);
});

module("moveInfo");

test("atariInfo_simple", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#O.'
        +'#..'
        +'#..'
        ;
    equals(b.text, expect);
    //1 group, 3 points
    same([1,3], b.atariInfo(b.WHITE, 1,1));
});

test("atariInfo_3groups", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 2,1);
    b.makeMove(b.BLACK, 1,2);
    b.makeMove(b.WHITE, 2,0);
    b.makeMove(b.WHITE, 2,2);
    b.makeMove(b.WHITE, 1,3);
    expect = ''
        +'.#O.'
        +'..#.'
        +'.#O.'
        +'.O..'
        ;
    equals(b.text, expect);
    //3 groups, 3 points
    same([3,3], b.atariInfo(b.WHITE, 1,1));
});

test("atariInfo_doesnt_say_suicide_is_atari", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    expect = ''
        +'#.'
        +'.#'
        ;
    equals(b.text, expect);
    same([0,0], b.atariInfo(b.WHITE, 0,1));
});

test("atariInfo_doesnt_double_count_same_group", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#O.'
        +'##.'
        +'#..'
        ;
    equals(b.text, expect);
    same([1,4], b.atariInfo(b.WHITE, 1,2));
});

test("isSuicide_simple", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    expect = ''
        +'#.'
        +'.#'
        ;
    ok(b.isSuicide(b.WHITE, 0,1));
});

test("isSuicide_mutual", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.WHITE, 1,1);
    expect = ''
        +'##'
        +'.O'
        ;
    ok(!b.isSuicide(b.WHITE, 0,1));
});

});
</script>

</head>
<body>
    <h1 id="qunit-header">gorules</h1>
    <h2 id="qunit-banner"></h2>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
