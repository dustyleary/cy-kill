<!DOCTYPE HTML>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://github.com/jquery/qunit/raw/master/qunit/qunit.css" type="text/css" media="screen" />
    <script type="text/javascript" src="http://github.com/jquery/qunit/raw/master/qunit/qunit.js"></script>
    <script type="text/javascript" src="gorules.js"></script>

<script>
$(document).ready(function(){

module("countLiberties");

test("a", function() {
    var b = new Board(2);
    equals(0, b.countLiberties(0,0));
});

test("b", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    equals(2, b.countLiberties(0,0));
});

test("c", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    equals(2, b.countLiberties(0,0));
    equals(2, b.countLiberties(0,1));
});

test("d", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,0);
    equals(1, b.countLiberties(0,0));
    equals(1, b.countLiberties(0,1));
    equals(1, b.countLiberties(1,0));
});

test("e", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 1,1);
    equals(0, b.countLiberties(0,0));
    equals(0, b.countLiberties(0,1));
    equals(0, b.countLiberties(1,0));
    equals(0, b.countLiberties(1,1));
});


module("makeMove");

test("simple", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    expect = ''
        +'#.'
        +'..'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 1,0);
    expect = ''
        +'##'
        +'..'
        ;
    equals(b.text, expect);
});

test("capture1", function() {
    var b = new Board(2);
    b.makeMove(b.WHITE, 0,0);
    b.makeMove(b.BLACK, 1,0);
    expect = ''
        +'O#'
        +'..'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 0,1);
    expect = ''
        +'.#'
        +'#.'
        ;
    equals(b.text, expect);
});

test("capture_ko", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 3,0);
    b.makeMove(b.WHITE, 2,1);
    expect = ''
        +'#.#O'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#OkO'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    //new move erases old ko
    b.makeMove(b.BLACK, 0,1);
    expect = ''
        +'#O.O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
});

test("capture_doesnt_think_simple_nonko_is_ko", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 0,0);
    b.makeMove(b.WHITE, 1,0);
    b.makeMove(b.WHITE, 2,1);
    b.makeMove(b.WHITE, 3,0);
    expect = ''
        +'OO.O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    b.makeMove(b.BLACK, 2,0);
    expect = ''
        +'..#O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
});

test("capture_returns_new_prisoner_count", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.WHITE, 1,0);
    //not a capturing move
    var captures = b.makeMove(b.WHITE, 1,1);
    equals(0, captures[0]);
    equals(0, captures[1]);
    expect = ''
        +'#O.'
        +'#O.'
        +'#..'
        ;
    equals(b.text, expect);
    //capture
    var captures = b.makeMove(b.WHITE, 1,2);
    equals(3, captures[0]);
    equals(0, captures[1]);
});

test("ko_capture_returns_new_prisoner_count", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 3,0);
    b.makeMove(b.WHITE, 2,1);
    var captures = b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#OkO'
        +'.#O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    equals(1, captures[0]);
    equals(0, captures[1]);

    b.makeMove(b.BLACK, 0,1);
    var captures = b.makeMove(b.BLACK, 2,0);
    expect = ''
        +'#k#O'
        +'##O.'
        +'....'
        +'....'
        ;
    equals(b.text, expect);
    equals(0, captures[0]);
    equals(1, captures[1]);
});

module("atariInfo");

test("simple", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#O.'
        +'#..'
        +'#..'
        ;
    equals(b.text, expect);
    //1 group, 3 points
    same([1,3], b.atariInfo(b.WHITE, 1,1));
});

test("3groups", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 2,1);
    b.makeMove(b.BLACK, 1,2);
    b.makeMove(b.WHITE, 2,0);
    b.makeMove(b.WHITE, 2,2);
    b.makeMove(b.WHITE, 1,3);
    expect = ''
        +'.#O.'
        +'..#.'
        +'.#O.'
        +'.O..'
        ;
    equals(b.text, expect);
    //3 groups, 3 points
    same([3,3], b.atariInfo(b.WHITE, 1,1));
});

test("suicide_is_not_atari", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    expect = ''
        +'#.'
        +'.#'
        ;
    equals(b.text, expect);
    same([0,0], b.atariInfo(b.WHITE, 0,1));
});

test("dont_double_count_same_group", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'#O.'
        +'##.'
        +'#..'
        ;
    equals(b.text, expect);
    same([1,4], b.atariInfo(b.WHITE, 1,2));
});

module("isSuicide");

test("simple", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    expect = ''
        +'#.'
        +'.#'
        ;
    ok(b.isSuicide(b.WHITE, 0,1));
});

test("mutual", function() {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.WHITE, 1,1);
    expect = ''
        +'##'
        +'.O'
        ;
    ok(!b.isSuicide(b.WHITE, 0,1));
});

module("fillsAnEye");

test("emptyBoard", function() {
    var b = new Board(2);
    ok(!b.fillsAnEye(b.BLACK, 0,0));
});

test("corner", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 1,1);
    ok(b.fillsAnEye(b.BLACK, 0,0));
});

test("minimal2eyes", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 3,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.BLACK, 2,1);
    b.makeMove(b.BLACK, 3,1);
    var expect = ''
        +'.#.#'
        +'####'
        +'....'
        +'....'
        ;
    equals(b.text, expect);

    ok(b.fillsAnEye(b.BLACK, 0,0));
    ok(b.fillsAnEye(b.BLACK, 2,0));
});

test("connecting_groups_doesnt_count_as_filling_an_eye", function() {
    var b = new Board(4);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 3,0);
    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 2,1);
    b.makeMove(b.BLACK, 1,2);
    b.makeMove(b.BLACK, 3,2);
    b.makeMove(b.BLACK, 0,3);
    b.makeMove(b.BLACK, 2,3);
    var expect = ''
        +'.#.#'
        +'#.#.'
        +'.#.#'
        +'#.#.'
        ;
    equals(b.text, expect);

    ok(!b.fillsAnEye(b.BLACK, 0,0));
    ok(!b.fillsAnEye(b.BLACK, 2,0));
    ok(!b.fillsAnEye(b.BLACK, 1,1));
    ok(!b.fillsAnEye(b.BLACK, 3,1));
    ok(!b.fillsAnEye(b.BLACK, 0,2));
    ok(!b.fillsAnEye(b.BLACK, 2,2));
    ok(!b.fillsAnEye(b.BLACK, 1,3));
    ok(!b.fillsAnEye(b.BLACK, 3,3));
});

module("getValidMoves");

test("emptyBoard", function () {
    var b = new Board(2);
    var r = b.getValidMoves(b.BLACK);
    same(r, ['aa', 'ba', 'ab', 'bb']);
    var r = b.getValidMoves(b.WHITE);
    same(r, ['aa', 'ba', 'ab', 'bb']);
});

test("simple", function () {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    var r = b.getValidMoves(b.WHITE);
    same(r, ['ba', 'ab', 'bb']);
});

test("simpleSuicideIsInvalid", function () {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    var r = b.getValidMoves(b.WHITE);
    same(r, []);
});

test("simpleCaptureIsOk", function () {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.WHITE, 0,1);
    expect = ''
        +'#.#'
        +'O#.'
        +'...'
        ;
    equals(b.text, expect);
    var r = b.getValidMoves(b.WHITE);
    same(r, ['ba', 'cb', 'ac', 'bc', 'cc']);
});

test("bigSuicideIsOk", function () {
    var b = new Board(2);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.WHITE, 0,1);
    var r = b.getValidMoves(b.WHITE);
    same(r, ['bb']);
});

test("koIsNotOk", function () {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,1);
    b.makeMove(b.BLACK, 2,0);
    b.makeMove(b.WHITE, 0,1);
    b.makeMove(b.WHITE, 1,0);
    expect = ''
        +'kO#'
        +'O#.'
        +'...'
        ;
    equals(b.text, expect);
    var r = b.getValidMoves(b.BLACK);
    same(r, ['cb', 'ac', 'bc', 'cc']);
});

module("pickRandomMcgMove");

test("has_uniform_distribution", function() {
    var counts = {};
    var b = new Board(3);
    for(var i=0; i<5000; i++) {
        var move = b.pickRandomMcgMove(b.BLACK);
        if(!counts[move]) counts[move] = 0;
        counts[move] += 1;
    }
    //treat them as rolling a 9-sided die...
    var i=1;
    var sum = 0;
    for(var pos in counts) {
        sum += i*counts[pos];
        i += 1;
    }
    //wolfram alpha says...
    var expected = 25000;
    var sdev = 182.6;
    var diff = Math.abs(sum - expected);
    ok(diff < sdev*3, ""+diff+" < "+sdev*3); //1% chance of triggering
});

test("doesnt_fill_eye", function() {
    var b = new Board(3);
    b.makeMove(b.BLACK, 0,0);
    b.makeMove(b.BLACK, 1,0);
    b.makeMove(b.BLACK, 2,0);

    b.makeMove(b.BLACK, 0,1);
    b.makeMove(b.BLACK, 2,1);

    b.makeMove(b.BLACK, 0,2);
    b.makeMove(b.BLACK, 1,2);
    b.makeMove(b.BLACK, 2,2);

    same(null, b.pickRandomMcgMove(b.BLACK));
});

});
</script>

</head>
<body>
    <h1 id="qunit-header">gorules</h1>
    <h2 id="qunit-banner"></h2>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
